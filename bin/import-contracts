#!/usr/bin/env ruby

require 'fileutils'

ENV["RAILS_ENV"] ||= ENV["RACK_ENV"] || "production"

url = ARGV[0]
unless url
  puts 'missing url'
  return
end

app_dir = File.join('app')
import_dir = File.join('app', 'tmp', 'csv')

FileUtils.mkdir_p import_dir
Dir.chdir(import_dir) do
  wget url
end

Dir.chdir(app_dir) do
  exec "RAILS_ENV=#{ENV["RAILS_ENV"]} bin/rake import:contracts"
end
